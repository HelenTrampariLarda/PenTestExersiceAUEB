# PenTestExersice

## Σκοπός
Στα πλαίσια της δεύτερης εργασίας, καλείστε να εκτελέσετε δοκιμές διείσδυσης (Penetration Τesting) σε πληροφορικά συστήματα, και να εκμεταλλευτείτε ευπάθειες σε διαδικτυακές εφαρμογές (Web applications).

## Φάση 1

### Εισαγωγή
Το Penetration Testing (PT) ή Pentesting, αποτελεί μία διαδικασία δοκιμής μίας εφαρμογής ή ενός συστήματος και στοχεύει στην εύρεση τυχόν ευπαθειών που θα μπορούσαν να εκμεταλλευτούν από έναν επιτιθέμενο για την απόκτηση μη εξουσιοδοτημένης πρόσβασης στο σύστημα. Πρόκειται λοιπόν για μία εκ των προτέρων σχεδιασμένη και εγκεκριμένη διαδικασία, για την αξιολόγηση του επιπέδου ασφαλείας ενός πληροφοριακού συστήματος, μέσω της εκμετάλλευσης (exploitation) ευπαθειών με ασφαλή και ελεγχόμενο τρόπο από έναν ειδικό ασφάλειας.
Η διαφορά ενός επιτιθέμενου (hacker) σε σχέση με έναν ειδικό ασφάλειας (pentester) είναι ότι ο δεύτερος έχει την εξουσιοδότηση να επιτεθεί στο σύστημα. Οι δύο αυτές οντότητες (συνήθως) χρησιμοποιούν σχεδόν τα ίδια εργαλεία, αλλά με διαφορετικό σκοπό.
Τα βήματα που ακολουθεί ένας Pentester για να ελέγξει και να εκμεταλλευτεί το σύστημα υπό εξέταση είναι τα ακόλουθα:
1. Αναγνώριση (Reconnaissance)
Αποτελεί την πιο χρονοβόρα φάση, καθώς ο Pentester προσπαθεί να συγκεντρώσει όσες περισσότερες πληροφορίες μπορεί για το στόχο του, είτε με ενεργές (actively) είτε με παθητικές (passively) διαδικασίες. Παραδείγματος χάριν, προσπαθεί να κατανοήσει την αρχιτεκτονική του εσωτερικού δικτύου του στόχου του.
2. Έλεγχος (Scanning)
Σε αυτή την φάση χρησιμοποιεί εργαλεία προκειμένου να εντοπίσει πιθανές ευπάθειες του συστήματος. Προσπαθεί να εντοπίσει υπηρεσίες/ανοιχτές θύρες του συστήματος, ευπαθείς εφαρμογές και πιθανά μέτρα προστασίας.
3. Επίτευξη Πρόσβασης (Gaining Access)
Ο Pentester επιχειρεί να εκμεταλλευτεί υφιστάμενες ευπάθειες και να εισέλθει στο σύστημα.
4. Διατήρηση Πρόσβασης (Maintaining Access)
Η διατήρηση της πρόσβασης απαιτεί την εγκατάσταση εργαλείων/μεθόδων (backdoors) ώστε να έχει τη δυνατότητα να υποκλέψει όσο το δυνατόν περισσότερες πληροφορίες από το σύστημα.
5. Απόκρυψη ιχνών (Covering Tracks)
Η διαδικασία του Pentesting δεν θα είχε νόημα αν ο διαχειριστής του συστήματος μπορεί να αντιληφθεί τις κακόβουλες ενέργειες και εντοπίσει τα ίχνη του επιτιθέμενου. Συνεπώς, σε αυτήν την φάση, ο Pentester ενεργεί έτσι ώστε να εξαλείψει τα ίχνη των ενεργειών του.

### Περιγραφή
Για την πραγματοποίηση της 1ης φάσης θα χρησιμοποιήσετε το Kali Linux [1]. Πρόκειται για μία ειδική διανομή Linux εμπλουτισμένη με τα απαραίτητα εργαλεία που εξυπηρετούν τον σκοπό της εργασίας. Επιπλέον της διανομής Kali Linux, που αποτελεί την πλατφόρμα για την πραγματοποίηση των επιθέσεων, ως μηχάνημα στόχο θα αξιοποιήσετε το Μetasploitable3 [2]. Πρόκειται για ένα εικονικό περιβάλλον λειτουργικού συστήματος που εσκεμμένα παρουσιάζει πληθώρα ευπαθειών και διανέμεται ελεύθερα για εκπαιδευτικούς σκοπούς. Το Μetasploitable3 παρέχει δύο εικονικές μηχανές (Virtual Machines - VMs), μία με λειτουργικό σύστημα Windows Server 2008 R2 και μία με Ubuntu Server 14.04. Στο πλαίσιο της εργασίας καλείστε να εγκαταστήσετε και τις δύο αυτές μηχανές. Ο σύνδεσμος [2] παρέχει αναλυτικές οδηγίες για την εγκατάστασή τους.

#### Metasploitable 
Αφού εγκαταστήσετε το Kali Linux και το Metasploitable VMs σε ένα τοπικό δίκτυο καλείστε να κάνετε χρήση των ακόλουθων εργαλείων:

##### Nmap
Το Nmap [3] αποτελεί ένα ευρέως χρησιμοποιούμενο εργαλείο για τα πρώτα στάδια του Pentest με σκοπό τον εντοπισμό των στοιχείων (assets) του συστήματος και του δικτύου που είναι ορατά σε έναν εξωτερικό παρατηρητή.

Χρησιμοποιώντας το Nmap: 

▪ Καθορίστε την τοπολογία του δικτύου σας. 

▪ Προσδιορίστε όσες περισσότερες πληροφορίες μπορείτε για το μηχάνημα στόχο (ανοιχτές θύρες (open ports), υπηρεσίες που παρέχονται, έκδοση του λειτουργικού συστήματος κ.ά.). 

▪ Χρησιμοποιείστε το Nmap Scripting Engine (NSE) [3] για τον εντοπισμό ευπαθειών στο μηχάνημα στόχο. Μην εκμεταλλευτείτε ακόμα τις ευπάθειες σε αυτή την φάση της εργασίας.

▪ Αν βρισκόσασταν στη θέση ενός επιτιθέμενου που θα έπρεπε να ελέγξει ένα σύστημα που προστατεύεται από firewall, πως θα αποφεύγατε την έγερση συναγερμού από το firewall κατά τη σάρωση;

##### Nessus
Το Nessus αποτελεί ίσως το πιο διαδεδομένο εργαλείο ανάλυσης ευπαθειών [4]. Το εργαλείο δεν διατίθεται δωρεάν όμως μπορείτε στην ελεύθερη δοκιμαστική έκδοση να χρησιμοποιήσετε ένα μέρος από τις δυνατότητες του (απαιτείται η δημιουργία λογαριασμού για την απόκτηση άδειας χρήσης). Ουσιαστικά πρόκειται για μία σουίτα εργαλείων που περιλαμβάνουν ένα μεγάλο αριθμό Plugins με σκοπό των εντοπισμό ευπαθειών στα υπό εξέταση συστήματα. Καλείστε να εγκαταστήσετε / παραμετροποιήσετε το Nessus στο Kali Linux και να σαρώσετε και τα δύο VMs του Μetasploitable3 για τον εντοπισμό των ευπαθειών τους.

Ελέγξτε τα VMs του metasploitable και: 

▪ Καταγράψτε τις ευπάθειες που παρουσιάζουν τα συστήματα. Σχολιάστε συνοπτικά και αναλύστε τα αποτελέσματα που αφορούν τις κρίσιμες ευπάθειες (critical vulnerabilities).

  o Πού οφείλονται οι ευπάθειες; 
  
  o Ποιες δυνατότητες δίνονται σε έναν επιτιθέμενο με την εκμετάλλευση των ευπαθειών; 
  
  o Με ποιους τρόπους μπορούν να αποφευχθούν/διορθωθούν οι ευπάθειες;
  
▪ Εξάγετε αναφορές σε μορφή .pdf με τα αποτελέσματα της κάθε σάρωσης, οι οποίες θα περιλαμβάνονται στα παραδοτέα της εργασίας.

▪ Εξάγετε αναφορές σε κατάλληλη μορφή για εκμετάλλευση με χρήση του εργαλείου msfconsole.


Επιπλέον εργαλείο ανάλυσης ευπαθειών
Αναζητήστε, εγκαταστήστε και αξιοποιήστε ένα τρίτο εργαλείο ανάλυσης ευπαθειών (vulnerability scanner) της επιλογής σας.

▪ Χρησιμοποιώντας το εργαλείο αυτό σαρώστε τα Μetasploitable VMs. 

▪ Συγκρίνετε τα αποτελέσματα σάρωσης με αυτά του Nessus.

▪ Αναφέρετε εν συντομία τα κύρια χαρακτηριστικά του, τον τρόπο λειτουργίας του και τις δυνατότητές του.

▪ Κάντε μία σύντομη σύγκριση του εργαλείου αυτού με το Nessus. Ποιες διαφορές παρουσιάζουν; Υπάρχει κάποια δυνατότητα στο ένα που δεν παρέχεται από το άλλο;


##### Msfconsole
Το msfconsole αποτελεί μέρος του Metasploit Framework (MSF) [5]. Πρόκειται για ένα εργαλείο μέσω του οποίου μπορείτε να πραγματοποιήσετε επιθέσεις σε ένα σύστημα στόχο. Το msfconsole διαθέτει και γραφικό περιβάλλον (Armitage), για τους σκοπούς όμως της εργασίας θα εκτελέσετε εντολές μόνο στην γραμμή εντολών (command line). To msfconsole είναι προεγκατεστημένο στη διανομή Kali Linux.
Χρησιμοποιώντας το msfconsole:

▪ Εισάγετε τις αναφορές των σαρώσεων που πραγματοποιήσατε με το Nessus.

▪ Εκμεταλλευτείτε 6 (συνολικά) ευπάθειες της επιλογής σας από τις κρίσιμες (Critical) και υψηλής (High) επικινδυνότητας των 2 VMs που παρέχονται από το Metasploitable3.

▪ Εκμεταλλευτείτε τυχόν τοπικές ευπάθειες στο σύστημα που μπορεί να σας επιτρέψουν να αποκτήσετε δικαιώματα διαχειριστή στο σύστημα (privilege escalation).

▪ Επιδείξτε με τα κατάλληλα screenshots ότι έχετε αποκτήσει πρόσβαση στο σύστημα στόχο.


#### Β) Windows

Σε αυτή τη φάση της εργασίας καλείστε να αξιολογήσετε το επίπεδο ασφάλειας ενός Windows υπολογιστή. Για το σκοπό αυτό εγκαταστήστε ένα μηχάνημα με λειτουργικό σύστημα Windows (όποια έκδοση Λειτουργικού Συστήματος επιθυμείτε) ως VM στο εσωτερικό δίκτυο σας και κάντε χρήση των εργαλείων που περιγράφονται ακολούθως.

##### ExploitDB
Στον σύνδεσμο [6] θα βρείτε μία βάση δεδομένων με περισσότερες από 40.000 εγγραφές για διάφορες πλατφόρμες και εφαρμογές. Πρόκειται για exploits που επιτρέπουν απομακρυσμένη πρόσβαση σε συστήματα, exploits διαδικτυακών εφαρμογών, τοπικά exploits για privilege escalation κ.ά. Επιλέξτε τουλάχιστον 2 ευπαθείς εφαρμογές (η ExploitDB παρέχει τόσο την ευπαθή εφαρμογή, όσο και το αντίστοιχο exploit) που θεωρείτε ότι η εκμετάλλευση τους θα σας επιτρέψει να επιφέρετε τη μεγαλύτερη βλάβη στο στόχο σας. Περιγράψτε με συντομία το είδος της πρόσβασης που επιτυγχάνετε με την εκμετάλλευση των ευπαθών εφαρμογών. Χρήσιμο θα ήταν να μην επιλέξετε μόνο FTP εφαρμογές/υπηρεσίες. Εκμεταλλευτείτε τις ευπάθειες με χρήση του msfconsole.

##### Msfvenom - Malicious executable
To msfvenom αποτελεί κι αυτό μέρος του Metasploit Framework (MSF) [5]. Πρόκειται για ένα εργαλείο μέσω του οποίου μπορείτε να δημιουργήσετε εκτελέσιμα αρχεία ενθυλακώνοντας κωδικοποιημένες (encoded) κακόβουλες εντολές (malicious payloads). Συνήθως το msfvenom χρησιμοποιείται για να μολύνει αρχεία εγκαταστάσεων (setup) δημοφιλών εφαρμογών.

Χρησιμοποιώντας το msfvenom:

▪ Δημιουργήστε ένα κακόβουλο εκτελέσιμο αρχείο μιας δημοφιλής εφαρμογής για Windows. Το payload που θα ενθυλακώσετε να είναι κατάλληλο για την επίτευξη μιας reverse tcp σύνδεσης

με το θύμα σας (“windows/meterpreter/reverse_tcp”). Δοκιμάστε να δημιουργήσετε εκτελέσιμα με ενθυλακωμένα διαφορετικά payloads και χρησιμοποιείστε τα.

▪ Ελέγξτε την ανιχνευσιμότητα των εκτελέσιμων σας, ελέγχοντας τα στο virustotal.com. Τροποποιήστε τις τιμές encoding και iteration του msfvenom προκειμένου να μειώσετε την ανιχνευσιμότητά τους, δηλαδή να μην χαρακτηρίζονται ως virus από όσον το δυνατόν περισσότερες anti-virus εφαρμογές. Ενδέχεται κάποια από τα encodings να μην λειτουργούν για εκτελέσιμα σε Windows.

▪ Εκτελέστε το αρχείο στο Windows VM. Δημιουργήστε μια reverse tcp σύνδεση με το θύμα.

▪ Προσπαθήστε να αποκομίσετε όσο το δυνατόν περισσότερες πληροφορίες από το θύμα σας. Οπωσδήποτε θα πρέπει να αποκτήσετε πληροφορίες για: όνομα χρήστη και κωδικούς (credential), αρχεία, εφαρμογές (που εκτελούνται), οθόνη εκτέλεσης του υπολογιστή, φωτογραφίες του χρήστη, δικτυακή κίνηση.


Συνοπτικά, για το Windows VM, θα πρέπει να εφαρμόσετε τις ακόλουθες ενέργειες:

▪ Εκτελέστε το Nmap και το Nessus για το έλεγχο του Windows μηχανήματος.

▪ Εγκαταστήσετε στο Windows υπολογιστή τις ευπαθείς υπηρεσίες και εφαρμογές που επιλέξατε και επαναλάβετε την εκτέλεση του Nmap και Nessus.

▪ Επιδείξτε ότι οι υπηρεσίες που εγκαταστήσατε λειτουργούν και δώστε στιγμιότυπα από τα εργαλεία ανάλυσης που επιβεβαιώνουν τις ευπάθειες το μηχάνημα. Προσπαθήστε να εκμεταλλευτείτε αυτές τις ευπάθειες μέσω του msfconsole.

▪ Εγκαταστήστε το κακόβουλο εκτελέσιμο που δημιουργήσατε με το msfvenom και αποκτήστε πληροφορίες για το σύστημα Windows.


## Φάση 2

### Εισαγωγή
Η εξέλιξη του διαδικτύου έχει εισάγει πληθώρα νέων διαδικτυακών εφαρμογών (Web Applications), οι οποίες βασίζονται σε τεχνολογίες όπως HTML5, PHP, JavaScript, SOAP, SQL Databases. Αρκετές από αυτές εμφανίζουν ευπάθειες τις οποίες κακόβουλοι χρήστες μπορούν να εκμεταλλευτούν με σκοπό να επιτεθούν στο σύστημα. Οι ευπάθειες αυτές μπορεί να οφείλονται είτε στη δομή των πρωτοκόλλων που χρησιμοποιούνται ή σε κάποια αδυναμία που ενδέχεται να έχει η ίδια η εφαρμογή λόγω αστοχίας του τρόπου υλοποίησης.

Οι κυριότερες μορφές από τέτοιου είδους επιθέσεις κατηγοριοποιούνται σύμφωνα με τον οργανισμό OWASP (Open Web Application Security Project ) [7] ως εξής (OWASP TOP10 2017):
1. Injection
2. Broken Authentication
3. Sensitive Data Exposure
4. XML External Entities (XXE)
5. Broken Access Control
6. Security Misconfigurations
7. Cross-Site Scripting (XSS)
8. Insecure Deserialization
9. Using Components with Known Vulnerabilities
10. Insufficient Logging & Monitoring

### Περιγραφή
Σκοπός της 2ης φάσης της εργασίας είναι η εξοικείωση με την ασφάλεια διαδικτυακών εφαρμογών. Σε αυτήν τη φάση της εργασίας καλείστε να μελετήσετε τις Web επιθέσεις με χρήση της πλατφόρμας μάθησης OWASP Security Shepherd [8]. Η πλατφόρμα αυτή διαθέτει σύντομα μαθήματα τα οποία επιδεικνύουν τις σημαντικότερες, σύμφωνα με τον οργανισμό OWASP, ευπάθειες μέσα από παραδείγματα του τρόπου εντοπισμού και εκμετάλλευσής τους.
Στόχος σας είναι να επιλύσετε τις δοκιμασίες που ενσωματώνουν, τεκμηριώνοντας τη διαδικασία εκμετάλλευσης των ευπαθειών. Δώστε ιδιαίτερη έμφαση σε επιθέσεις των κατηγοριών:

▪ Injection

▪ Broken Authentication and Session Management

▪ Cross-Site Scripting (XSS)

▪ Access Control Flows

▪ Security Misconfiguration

▪ Cross Site Request Forgery


Χρήσιμα Εργαλεία για εκμετάλλευση ευπαθειών – έλεγχο ασφάλειας

▪ OWASP WTE

▪ WebScarab-NG

▪ Zed Attack Proxy (ZAP)

▪ Burp Suite

▪ John the Ripper

▪ Hashcat

▪ sqlmap

▪ Firefox Plugins:

  o Cookie Manager 

  o HackBar 
  
  o Web Developper Toolbar
  
  o Tamper Data 
  
  o HTTP Header Live
  

Ακολούθως δοκιμάστε τις γνώσεις σας στην ευπαθή (για εκπαιδευτικούς σκοπούς) web εφαρμογή OWASP Juice Shop [9]. Προσπαθήστε να εκμεταλλευθείτε όσες περισσότερες από τις περιεχόμενες ευπάθειες.

### Παραδοτέα
Σε κάθε παραδοτέο, όπως αυτά ορίζονται από το προαναφερόμενο χρονοδιάγραμμα, οφείλετε να παραδώσετε την αναφορά που περιλαμβάνει την τεκμηρίωση των ζητούμενων της εκάστοτε φάσης.
Συνολικά, οι αναφορές σας οφείλουν να περιέχουν:
#### Φάση 1
1. Σχολιασμός και τεκμηρίωση των βημάτων που κάνατε για όλα τα εργαλεία που αναλύθηκαν στην εργασία.
2. Στιγμιότυπα από την παραμετροποίηση των εργαλείων και εκτέλεση τους (screenshots) με απαραίτητο σύντομο σχολιασμό.
3. Αναφορές που παρήχθησαν από τα εργαλεία ανάλυσης ευπαθειών.

#### Φάση 2
1. Επεξήγηση του τρόπου εκμετάλλευσης των ευπαθειών για τις δοκιμασίες που επιλύθηκαν στην πλατφόρμα OWASP Security Shepherd.
2. Στιγμιότυπα εκτέλεσης των επιθέσεων (screenshots).
3. Σύντομη περιγραφή των δυσκολιών που αντιμετωπίστηκαν κατά την προσπάθεια επίλυσης των δοκιμασιών.
4. Καταγραφή επιτυχημένων και αποτυχημένων προσπαθειών εκμετάλλευσης της ευπαθούς εφαρμογής OWASP Juice Shop. Για κάθε προσπάθεια περιγράψτε τις ενέργειες σας, το αποτέλεσμα της προσπάθειας και μια επεξήγηση γιατί πιστεύετε ότι δεν δούλεψε (στην περίπτωση αποτυχημένης προσπάθειας).
5. Περιγραφή ενδεχόμενων αντιμέτρων - διαδικασιών ενδυνάμωσης.

Η εργασία πρέπει να παραδοθεί σε ομάδες μέχρι τριών ατόμων μέσω της πλατφόρμας ηλεκτρονικής μάθησης e-class εντός της προκαθορισμένης προθεσμίας. Το τελικό παραδοτέο πρέπει να είναι αρχείο .zip/rar με όνομα ΑριθμόςΜητρώου1_ΑριθμόςΜητρώου2_ΑριθμόςΜητρώου3_LabΒ2_FasiX.zip .
Μέσα στο παραδοτέο, καλείστε να παρουσιάσετε κάθε φάση και κάθε εύρημα με την αντίστοιχη δομή ενός εταιρικού παραδοτέου, όπως αυτό θα αναλογούσε σε κανονική αναφορά που αποστέλλεται σε πελάτη. Συγκεκριμένα, αυτό περιλαμβάνει για κάθε εύρημα που θα εντοπίσετε/καταγράψετε, να παρουσιάσετε μέσα στο παραδοτέο σας:
1. Το επίπεδο κρισιμότητας (risk rating) κάθε επιτυχημένης επίθεσης, βάσει κάποιας αναγνωρισμένης κλίμακας (CVE/CWE, CVSS).
2. Τις βασικές εντολές αναπαραγωγής της επίθεσης μαζί με σύντομα screenshots.
3. Τρόπο εξυγίανσης της ευπάθειας που χρησιμοποιήσατε, προκειμένου να βοηθήσετε τον πελάτη να διορθώσει το πρόβλημα που σας έδωσε πρόσβαση.

Ημ/νια παράδοσης: 22/03/2023, 23.59 μέσω Eclass.

Εξέταση μαθήματος: Θα ακολουθήσει εξέταση της εργασίας και των θεμάτων που αυτή αφορά σε προκαθορισμένη ημ/νια από τους διδάσκοντες. Η ημ//νια θα ανακοινωθεί μέσω eclass. Για να πετύχει προβιβάσιμο βαθμό στο μάθημα, κάθε φοιτητής πρέπει να πετύχει προβιβάσιμο βαθμό (ι) στο παραδοτέο της εργασίας, και (ιι) κατά την αξιολόγηση/παρουσίαση των θεμάτων της εργασίες μαζί με τις ερωτήσεις που θα του απευθυνθούν.

### Βιβλιογραφία
[1] The ultimate penetration testing platform, https://www.kali.org/

[2] Metasploitable3, https://github.com/rapid7/metasploitable3

[3] Nmap: the Network Mapper, https://nmap.org/

[4] Nessus: Vulnerability Scanning and Vulnerability Management https://www.tenable.com/products/nessus/nessus-professional

[5] Metasploit - The world’s most used penetration testing framework - https://www.metasploit.com/

[6] Offensive Security Exploit Database Archive - https://www.exploit-db.com/

[7] The Open Web Application Security Project (OWASP) - https://www.owasp.org/index.php/Main_Page

[8] OWASP Security Shepherd 3.1, https://github.com/OWASP/SecurityShepherd/releases

[9] OWASP Juice Shop, https://github.com/bkimminich/juice-shop/releases/tag/v9.0.1
